(function(t){t.Type=function(t){var n=function(){return this.initialize?this.initialize.apply(this,arguments):void 0};for(var i in t)t.hasOwnProperty(i)&&(n.prototype[i]=t[i]);return n};var n=t.pointLROf=function(t,n){var i=t.i*n.j,r=t.j*n.i,o=i-r;return o>0?1:0>o?2:0},i=t.pointLeftOf=function(t,i,r){return 1===n(e(i,r),e(i,t))},r=t.pointRightOf=function(t,i,r){return 2===n(e(i,r),e(i,t))},o=function(t,n){this.i=n.x-t.x,this.j=n.y-t.y};o.prototype.length=function(){return Math.sqrt(this.i*this.i+this.j+this.j)},o.prototype.toString=function(){return"<"+this.i+","+this.j+">"};var e=t.vector=function(t,n){return new o(t,n)},u=function(t,n){this.x=t,this.y=n};t.point=function(t,n){return new u(t,n)},u.prototype.leftOf=function(t,n){return i(t,n,this)},u.prototype.rightOf=function(t,n){return r(t,n,this)},u.prototype.toString=function(){return"("+this.x+","+this.y+")"}})(function(){return this.jeos={},this.jeos}()),function(t){var n=t.Type({initialize:function(n,i){this.p=n,this.q=i,this.pq=t.vector(n,i)},toString:function(){return"Edge("+this.p+","+this.q+")"}});t.Edge=n}(function(){return this.jeos}()),function(t){var n=t.Ring=t.Type({initialize:function(t){if(!(t.length>=4))throw Error("Ring must have 3 points!");if(!t[0].equals(t[t.length-1]))throw Error("Invalid Ring!");this.ring=t}});n.from=function(i){var r=i.map(function(n){return t.point(n[0],n[1])});return r.push(r[0]),new n(r)}}(function(){return this.jeos}()),function(t){var n=t.Edge,i=function(i){this.edges=n.from(t.antiClockWise(i))},r=function(){return function(t,n){return t.pd<n.pd?-1:n.pd>t.pd?1:0}},o=function(t,n){var i=t.distanceOfPoint(n.p),r=t.distanceOfPoint(n.q);return i>r?{edge:n.invert(),pd:r,qd:i}:{edge:n,pd:i,qd:r}},e=function(t,n,i){return t>=n&&i>=t},u=function(t,n){var i=n.indexOf(t.p);e(i,0,1)||(i=n.indexOf(t.pointAt(t.indexOf(n.p))));var r=n.indexOf(t.q);e(r,0,1)||(r=n.indexOf(t.pointAt(t.indexOf(n.q))));var o=t.distanceOfPoint(n.pointAt(i)),u=t.distanceOfPoint(n.pointAt(r));return r>i?[i,r,o,u]:[r,i,u,o]},f=function(t,n){return t.slice(0).filter(function(i,r){return i.pd<n.qd?(t.splice(r,1),!0):!1})},c=function(t,n){var i=[];return n.forEach(function(n,r){var o=Math.max(t[0],n[0]),e=Math.min(t[1],n[1]);e>o?i.push(r):o===e&&i.push(r)}),i.length?i:!1},s=function(t,n){t.slice(0).forEach(function(t){var i=c(t,n);i!==!1&&i.forEach(function(){})})},h=function(t,n){var i=(t[3]-t[2])/(t[1]-t[0]);return t[2]+i*(n-t[0])},a=function(t,n,i){i.forEach(function(i){var r,o=n[i],e=t[0]<=o[0]?[t,o]:[o,t],u=Math.max(e[0][0],e[1][0]),f=Math.min(e[0][1],e[1][1]);u===f?r=e:f>u&&(r=e.reduce(function(t,n){var i=[];u>t[0]&&i.push([t[0],u,t[2],h(t,u)]);var r=Math.min(h(t,u),n[2]);return Math.min(t[3],h(n,f)),i.push([u,f,r,r]),n[1]>f&&i.push([f,n[1],h(n,f),n[3]]),i})),Array.prototype.splice.apply(n,[i,1].concat(r))})},p=function(t,n,i){for(var r=[];n.length;){var o=n.shift(),e=[u(o.edge,t)],h=f(n,o);h.forEach(function(n){var i=u(n.edge,t),r=c(i,e);r?a(i,e,r):e.push(i)}),s(e,r),r=r.concat(e)}var p=[],v=function(n,i){var r,o,e=t.pq[0],u=t.pq[1];0!==e?(o=0-e*i/t.length(),r=0-u/e*o):(r=u*i/t.length(),o=0-e/u*r);var f=t.pointAt(n);return[f[0]+r,f[1]+o]};return r.forEach(function(t){var n=i(t[2]),r=i(t[3]);p.push(v(t[0],n)),p.push(v(t[1],r))}),p};i.prototype.offset=function(t){var n=this.edges,i=n.map(function(n){var i=[];return n.forOthers(function(t){n.projects(t)&&n.isLeft(t)&&t.isLeft(n)&&i.push(o(n,t))}),i.sort(r(n)),p(n,i,t)});return i},t.WeightedOffset=i}(function(){return this.jeos}());